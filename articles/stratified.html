<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3: Stratified contrasts • ratesci</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="3: Stratified contrasts">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ratesci</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/single_rate.html">1: Single rate</a></li>
    <li><a class="dropdown-item" href="../articles/basic_contrasts.html">2: Basic contrasts (single stratum)</a></li>
    <li><a class="dropdown-item" href="../articles/stratified.html">3: Stratified contrasts</a></li>
    <li><a class="dropdown-item" href="../articles/paired_contrasts.html">4: Paired contrasts</a></li>
    <li><a class="dropdown-item" href="../articles/tests.html">5: Hypothesis tests</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/petelaud/ratesci/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>3: Stratified contrasts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/petelaud/ratesci/blob/master/vignettes/stratified.Rmd" class="external-link"><code>vignettes/stratified.Rmd</code></a></small>
      <div class="d-none name"><code>stratified.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/petelaud/ratesci" class="external-link">ratesci</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction-to-scoreci-for-computing-confidence-intervals-for-stratified-comparisons-of-independent-binomial-or-poisson-rates">Introduction to scoreci() for computing confidence intervals for
stratified comparisons of independent binomial or Poisson rates<a class="anchor" aria-label="anchor" href="#introduction-to-scoreci-for-computing-confidence-intervals-for-stratified-comparisons-of-independent-binomial-or-poisson-rates"></a>
</h2>
<p>Stratified analysis might be required for combining results from
multiple studies in a meta-analysis, or adjusting clinical trial results
for factors used in a stratified randomisation. Associated tests for
common effects over strata (homogeneity) can also be useful for
examining subgroup effects in a clinical trial. The illustration below
uses data from a meta-analysis of 9 trials studying the effectiveness of
graduated compression stockings for prevention of postoperative deep
vein thrombosis (DVT) <span class="citation">(from <a href="#ref-roderick2005">Roderick et al. 2005</a>)</span>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">compress</span>, package <span class="op">=</span> <span class="st">"ratesci"</span><span class="op">)</span></span>
<span><span class="va">strat_rd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scoreci.html">scoreci</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">compress</span><span class="op">$</span><span class="va">event.gcs</span>, </span>
<span>                   n1 <span class="op">=</span> <span class="va">compress</span><span class="op">$</span><span class="va">n.gcs</span>, </span>
<span>                   x2 <span class="op">=</span> <span class="va">compress</span><span class="op">$</span><span class="va">event.control</span>, </span>
<span>                   n2 <span class="op">=</span> <span class="va">compress</span><span class="op">$</span><span class="va">n.control</span>, </span>
<span>                   contrast <span class="op">=</span> <span class="st">"RD"</span>, </span>
<span>                   stratified <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">strat_rd</span><span class="op">$</span><span class="va">estimates</span></span>
<span><span class="co">#&gt;       lower    est   upper level  p1hat p2hat  p1mle p2mle</span></span>
<span><span class="co">#&gt; [1,] -0.163 -0.124 -0.0866  0.95 0.0858  0.21 0.0936 0.218</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_rd</span><span class="op">$</span><span class="va">pval</span></span>
<span><span class="co">#&gt;      chisq pval2sided theta0 scorenull pval_left pval_right</span></span>
<span><span class="co">#&gt; [1,]  42.2   8.25e-11      0      -6.5  4.12e-11          1</span></span></code></pre></div>
<p>The Qtest object provides a heterogeneity test and related
quantities, including an assessment of qualitative heterogeneity
(indicating whether treatment effects are in opposite directions in
different strata). All of which are derived using the score statistic
and its estimated variance, for a consistent approach - see <span class="citation">(<a href="#ref-laud2017">Laud 2017</a> Supplementary
Appendix S4)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_rd</span><span class="op">$</span><span class="va">Qtest</span></span>
<span><span class="co">#&gt;            Q         Q_df     pval_het           I2         tau2           Qc </span></span>
<span><span class="co">#&gt;     14.41529      8.00000      0.07156     44.50337      0.00176      0.00000 </span></span>
<span><span class="co">#&gt; pval_qualhet </span></span>
<span><span class="co">#&gt;      0.99609</span></span></code></pre></div>
<!--

``` r
strat_rr <- scoreci(x1 = compress$event.gcs, 
                   n1 = compress$n.gcs, 
                   x2 = compress$event.control, 
                   n2 = compress$n.control, 
                   contrast = "RR", 
                   stratified = TRUE)
strat_rr$Qtest
#>            Q         Q_df     pval_het           I2         tau2           Qc 
#>     1.01e+01     8.00e+00     2.56e-01     2.10e+01     1.02e-04     0.00e+00 
#> pval_qualhet 
#>     9.96e-01
```
-->
<p>The stratdata object provides estimates and intervals for each
stratum, along with details of stratum weights and contributions to the
Q-statistic (these may be further examined using the
<code>hetplot</code> argument).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_rd</span><span class="op">$</span><span class="va">stratdata</span></span>
<span><span class="co">#&gt;       x1j n1j x2j n2j p1hatj p2hatj wt_fixed wtpct_fixed wtpct_rand   theta_j</span></span>
<span><span class="co">#&gt;  [1,]  15  97  37 103 0.1546 0.3592    49.95       15.62      15.62 -2.04e-01</span></span>
<span><span class="co">#&gt;  [2,]   0   8   5  10 0.0000 0.5000     4.44        1.39       1.39 -5.00e-01</span></span>
<span><span class="co">#&gt;  [3,]  11  50  23  48 0.2200 0.4792    24.49        7.66       7.66 -2.59e-01</span></span>
<span><span class="co">#&gt;  [4,]   4 110  16 110 0.0364 0.1455    55.00       17.19      17.19 -1.10e-01</span></span>
<span><span class="co">#&gt;  [5,]   7  65   7  32 0.1077 0.2188    21.44        6.70       6.70 -1.13e-01</span></span>
<span><span class="co">#&gt;  [6,]   8  25   8  25 0.3200 0.3200    12.50        3.91       3.91 -2.98e-08</span></span>
<span><span class="co">#&gt;  [7,]   5 126  17 126 0.0397 0.1349    63.00       19.69      19.69 -9.57e-02</span></span>
<span><span class="co">#&gt;  [8,]   0 104   4  92 0.0000 0.0435    48.82       15.26      15.26 -4.51e-02</span></span>
<span><span class="co">#&gt;  [9,]   7  80  16  81 0.0875 0.1975    40.25       12.58      12.58 -1.10e-01</span></span>
<span><span class="co">#&gt;       lower_j  upper_j     V_j Stheta_j    Q_j</span></span>
<span><span class="co">#&gt;  [1,]  -0.321 -0.08495 0.00369  -0.0804 1.7506</span></span>
<span><span class="co">#&gt;  [2,]  -0.787 -0.10319 0.04111  -0.3758 3.4351</span></span>
<span><span class="co">#&gt;  [3,]  -0.435 -0.07103 0.00914  -0.1350 1.9917</span></span>
<span><span class="co">#&gt;  [4,]  -0.190 -0.03530 0.00151   0.0151 0.1517</span></span>
<span><span class="co">#&gt;  [5,]  -0.290  0.04065 0.00704   0.0132 0.0246</span></span>
<span><span class="co">#&gt;  [6,]  -0.260  0.25979 0.01763   0.1242 0.8753</span></span>
<span><span class="co">#&gt;  [7,]  -0.169 -0.02700 0.00132   0.0290 0.6349</span></span>
<span><span class="co">#&gt;  [8,]  -0.101 -0.00470 0.00119   0.0807 5.4843</span></span>
<span><span class="co">#&gt;  [9,]  -0.221 -0.00172 0.00300   0.0142 0.0671</span></span></code></pre></div>
<div class="section level3">
<h3 id="random-effects">Random effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h3>
<p>In this instance, there is weak evidence
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.07</mn></mrow><annotation encoding="application/x-tex">p = 0.07</annotation></semantics></math>)
that the treatment effect (on the RD scale) varies across strata.
(Estimation on the RR contrast scale gives more consistency across
strata.) For the sake of illustration, a random effects analysis of RD
would be obtained as follows, giving a wider interval that incorporates
the stratum variability. The <code>random = TRUE</code> option invokes
the t-distribution asymptotic score (TDAS) method <span class="citation">(<a href="#ref-laud2017">Laud 2017</a>)</span>, which
modifies the asymptotic score methodology using formulae from the
Hartung-Knapp-Sidik-Jonkman (HKSJ) random effects meta-analysis method
(with superior performance compared to the DerSimonian-Laird
method).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_rd_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scoreci.html">scoreci</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">compress</span><span class="op">$</span><span class="va">event.gcs</span>, </span>
<span>                   n1 <span class="op">=</span> <span class="va">compress</span><span class="op">$</span><span class="va">n.gcs</span>, </span>
<span>                   x2 <span class="op">=</span> <span class="va">compress</span><span class="op">$</span><span class="va">event.control</span>, </span>
<span>                   n2 <span class="op">=</span> <span class="va">compress</span><span class="op">$</span><span class="va">n.control</span>, </span>
<span>                   contrast <span class="op">=</span> <span class="st">"RD"</span>, </span>
<span>                   stratified <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   random <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   prediction <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">strat_rd_rand</span><span class="op">$</span><span class="va">estimates</span></span>
<span><span class="co">#&gt;       lower    est upper level  p1hat p2hat  p1mle p2mle</span></span>
<span><span class="co">#&gt; [1,] -0.188 -0.124 -0.06  0.95 0.0858  0.21 0.0936 0.218</span></span></code></pre></div>
<p>Note that the TDAS method does not include a skewness correction, so
when <code>random = TRUE</code>, the <code>skew</code> argument only
affects the <code>stratdata</code> output element.</p>
<p>A prediction interval for the treatment effect in a new study <span class="citation">(<a href="#ref-higgins2008">Higgins, Thompson, and
Spiegelhalter 2008</a>)</span> can be obtained using
<code>prediction = TRUE</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_rd_rand</span><span class="op">$</span><span class="va">prediction</span></span>
<span><span class="co">#&gt;       lower  upper</span></span>
<span><span class="co">#&gt; [1,] -0.244 0.0158</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-higgins2008" class="csl-entry">
Higgins, Julian P. T., Simon G. Thompson, and David J. Spiegelhalter.
2008. <span>“A Re-Evaluation of Random-Effects Meta-Analysis.”</span>
<em>Journal of the Royal Statistical Society Series A: Statistics in
Society</em> 172 (1): 137–59. <a href="https://doi.org/10.1111/j.1467-985x.2008.00552.x" class="external-link">https://doi.org/10.1111/j.1467-985x.2008.00552.x</a>.
</div>
<div id="ref-laud2017" class="csl-entry">
Laud, Peter J. 2017. <span>“Equal<span>-</span>Tailed Confidence
Intervals for Comparison of Rates.”</span> <em>Pharmaceutical
Statistics</em> 16 (5): 334–48. <a href="https://doi.org/10.1002/pst.1813" class="external-link">https://doi.org/10.1002/pst.1813</a>.
</div>
<div id="ref-roderick2005" class="csl-entry">
Roderick, P, G Ferris, K Wilson, H Halls, D Jackson, R Collins, and C
Baigent. 2005. <span>“Towards Evidence-Based Guidelines for the
Prevention of Venous Thromboembolism: Systematic Reviews of Mechanical
Methods, Oral Anticoagulation, Dextran and Regional Anaesthesia as
Thromboprophylaxis.”</span> <em>Health Technology Assessment</em> 9
(49). <a href="https://doi.org/10.3310/hta9490" class="external-link">https://doi.org/10.3310/hta9490</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pete Laud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
